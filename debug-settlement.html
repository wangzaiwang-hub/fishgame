<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼å•è¯ç»“ç®—è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f8ff;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .debug-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .debug-button:hover {
            background: #45a049;
        }
        .debug-output {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .console-log {
            color: #333;
        }
        .console-error {
            color: #d32f2f;
        }
        .console-warn {
            color: #ff9800;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ‹¼å•è¯ç»“ç®—è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-panel">
        <h3>ğŸ“ é—®é¢˜æè¿°</h3>
        <p>æ‹¼å•è¯æ¨¡å¼å®Œæˆåï¼Œç»“ç®—é¢æ¿æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
        <p>éœ€è¦æ£€æŸ¥ï¼š</p>
        <ul>
            <li>onSpellGameComplete() æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨</li>
            <li>settlementManager.startSettlement() æ˜¯å¦æ­£ç¡®æ‰§è¡Œ</li>
            <li>åŠ¨ç”»çŠ¶æ€æ˜¯å¦æ­£ç¡®è®¾ç½®</li>
            <li>render() æ–¹æ³•æ˜¯å¦æ­£ç¡®æ¸²æŸ“</li>
        </ul>
    </div>

    <div class="debug-panel">
        <h3>ğŸ§ª è°ƒè¯•æ“ä½œ</h3>
        <button class="debug-button" onclick="checkConsole()">æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—</button>
        <button class="debug-button" onclick="simulateSpellComplete()">æ¨¡æ‹Ÿæ‹¼å•è¯å®Œæˆ</button>
        <button class="debug-button" onclick="openGame()">æ‰“å¼€æ¸¸æˆ</button>
        <button class="debug-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        
        <div id="debug-output" class="debug-output">
            ç­‰å¾…è°ƒè¯•æ“ä½œ...
        </div>
    </div>

    <div class="debug-panel">
        <h3>ğŸ¯ è°ƒè¯•æ­¥éª¤</h3>
        <ol>
            <li>ç‚¹å‡»"æ‰“å¼€æ¸¸æˆ"æŒ‰é’®</li>
            <li>è¿›å…¥æ¸¸æˆ â†’ é€‰æ‹©å­¦ä¹ æ¨¡å¼ â†’ é€‰æ‹©æ‹¼å•è¯ â†’ é€‰æ‹©å•è¯</li>
            <li>å¼€å§‹æ‹¼å•è¯æ¸¸æˆï¼Œæ•…æ„é’“é”™å­—æ¯æµ‹è¯•é‡ç½®åŠŸèƒ½</li>
            <li>ç„¶åæ­£ç¡®æ‹¼å®Œå•è¯</li>
            <li>è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼Œæ£€æŸ¥ç»“ç®—é¢æ¿æ˜¯å¦æ˜¾ç¤º</li>
        </ol>
    </div>

    <script>
        let debugOutput = document.getElementById('debug-output');
        
        function log(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `console-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            debugOutput.appendChild(logEntry);
            debugOutput.scrollTop = debugOutput.scrollHeight;
            
            // åŒæ—¶è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
            console[type](message);
        }
        
        function clearLog() {
            debugOutput.innerHTML = 'æ—¥å¿—å·²æ¸…ç©º...';
        }
        
        function checkConsole() {
            log('è¯·æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°ï¼Œå…³æ³¨ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š');
            log('1. "=== æ‹¼å•è¯æ¸¸æˆå®Œæˆ ===" - onSpellGameCompleteè°ƒç”¨');
            log('2. "=== ç»“ç®—ç®¡ç†å™¨å¯åŠ¨ ===" - startSettlementæ‰§è¡Œ');
            log('3. "[Settlement] åŠ¨ç”»çŠ¶æ€è®¾ç½®ä¸º: dropping" - åŠ¨ç”»çŠ¶æ€');
            log('4. "[Settlement Render] åŠ¨ç”»çŠ¶æ€: ..." - æ¸²æŸ“çŠ¶æ€');
            log('5. å¦‚æœæ²¡æœ‰çœ‹åˆ°è¿™äº›æ—¥å¿—ï¼Œè¯´æ˜æµç¨‹ä¸­æ–­äº†', 'warn');
        }
        
        function simulateSpellComplete() {
            log('=== æ¨¡æ‹Ÿæ‹¼å•è¯å®Œæˆåœºæ™¯ ===');
            log('é¢„æœŸæµç¨‹ï¼š');
            log('1. wordManager.isGameComplete() è¿”å› true');
            log('2. è°ƒç”¨ onSpellGameComplete()');
            log('3. è®¾ç½® state = GAME_SETTLEMENT');
            log('4. è°ƒç”¨ settlementManager.startSettlement(null, scoreManager, "spell", wordManager)');
            log('5. è®¾ç½® animationState = "dropping"');
            log('6. åœ¨æ¸²æŸ“å¾ªç¯ä¸­è°ƒç”¨ settlementManager.render()');
            log('æ£€æŸ¥å®é™…æ¸¸æˆæ˜¯å¦æŒ‰æ­¤æµç¨‹æ‰§è¡Œ', 'warn');
        }
        
        function openGame() {
            log('æ­£åœ¨æ‰“å¼€æ¸¸æˆ...');
            try {
                // å°è¯•æ‰“å¼€æ¸¸æˆ
                window.open('index.html', '_blank');
                log('æ¸¸æˆå·²åœ¨æ–°çª—å£æ‰“å¼€');
                log('è¯·æŒ‰ç…§è°ƒè¯•æ­¥éª¤è¿›è¡Œæµ‹è¯•', 'warn');
            } catch (error) {
                log('æ‰“å¼€æ¸¸æˆå¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // ç›‘å¬æ¥è‡ªæ¸¸æˆçª—å£çš„æ¶ˆæ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'debug') {
                log(`[æ¥è‡ªæ¸¸æˆ] ${event.data.message}`, event.data.level || 'log');
            }
        });
        
        // åˆå§‹åŒ–
        log('æ‹¼å•è¯ç»“ç®—è°ƒè¯•å·¥å…·å·²å¯åŠ¨');
        log('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è°ƒè¯•');
    </script>
</body>
</html>