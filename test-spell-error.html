<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼å•è¯é”™è¯¯é‡ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f8ff;
        }
        .test-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-output {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            margin-left: 10px;
            font-weight: bold;
        }
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.info { background: #2196F3; color: white; }
        .display-area {
            border: 2px solid #333;
            padding: 20px;
            margin: 10px 0;
            background: #fff;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <h1>ğŸ£ æ‹¼å•è¯é”™è¯¯é‡ç½®åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-panel">
        <h3>ğŸ¯ æµ‹è¯•ç›®æ ‡</h3>
        <p>éªŒè¯åœ¨æ‹¼å•è¯æ¨¡å¼ä¸­ï¼š</p>
        <ol>
            <li>é’“åˆ°é”™è¯¯å­—æ¯æ—¶ï¼š<strong>åªæ¸…ç©ºæ‹¼å†™åŒºåŸŸï¼Œä¸æ¸…é™¤é±¼ç±»</strong></li>
            <li>ä¸ä¼šå°†é”™è¯¯å­—æ¯æ·»åŠ åˆ°æ‹¼å†™åŒºåŸŸ</li>
            <li>ä¼šç«‹å³æ¸…ç©ºå·²æ‹¼å†™çš„å­—æ¯</li>
            <li>æ‹¼å†™æˆåŠŸåæ˜¾ç¤ºgameoverç»“ç®—ç•Œé¢</li>
        </ol>
    </div>

    <div class="test-panel">
        <h3>ğŸ“Š å½“å‰æ‹¼å†™çŠ¶æ€</h3>
        <div class="display-area" id="spellingDisplay">
            ç­‰å¾…åˆå§‹åŒ–...
        </div>
        <p><strong>è¯´æ˜ï¼š</strong>ä¸Šæ–¹æ˜¾ç¤ºå½“å‰çš„æ‹¼å†™è¿›åº¦ï¼Œæ ¼å¼ä¸º "å•è¯æ„æ€ + å·²æ‹¼å­—æ¯ + ä¸‹åˆ’çº¿"</p>
    </div>

    <div class="test-panel">
        <h3>ğŸ§ª æµ‹è¯•æ“ä½œ</h3>
        <button class="test-button" onclick="initializeTest()">1. åˆå§‹åŒ–æµ‹è¯•</button>
        <button class="test-button" onclick="testCorrectLetter()">2. é’“æ­£ç¡®å­—æ¯</button>
        <button class="test-button" onclick="testWrongLetter()">3. é’“é”™è¯¯å­—æ¯</button>
        <button class="test-button" onclick="testCompleteWord()">4. å®Œæˆå•è¯æ‹¼å†™</button>
        <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        
        <div class="test-output" id="testOutput">æµ‹è¯•æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/wordManager.js"></script>
    
    <script>
        let wordManager;
        let testResults = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const output = document.getElementById('testOutput');
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            output.appendChild(logEntry);
            output.scrollTop = output.scrollHeight;
            
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('testOutput').innerHTML = 'æ—¥å¿—å·²æ¸…ç©º...';
        }
        
        function updateSpellingDisplay() {
            const display = document.getElementById('spellingDisplay');
            if (!wordManager) {
                display.innerHTML = 'æœªåˆå§‹åŒ–';
                return;
            }
            
            const currentText = wordManager.getCurrentDisplayText();
            const currentWord = wordManager.getCurrentWord();
            const progress = wordManager.getCurrentProgress();
            
            if (currentWord) {
                display.innerHTML = `
                    <div>ç›®æ ‡å•è¯: ${currentWord.word} (${currentWord.meaning})</div>
                    <div>å½“å‰è¿›åº¦: ${currentText}</div>
                    <div>å·²æ‹¼å­—æ¯: [${progress.spelledLetters.join(', ')}]</div>
                    <div>éœ€è¦å­—æ¯: [${progress.requiredLetters.join(', ')}]</div>
                `;
            } else {
                display.innerHTML = 'æ— å½“å‰å•è¯';
            }
        }
        
        function initializeTest() {
            log('=== æµ‹è¯•1ï¼šåˆå§‹åŒ–æ‹¼å•è¯æ¨¡å¼ ===');
            
            try {
                // åˆ›å»ºå•è¯ç®¡ç†å™¨
                wordManager = new WordManager();
                wordManager.loadDefaultWords();
                log(`âœ… å•è¯åŠ è½½æˆåŠŸï¼Œå…±${wordManager.words.length}ä¸ªå•è¯`);
                
                // è®¾ç½®æ‹¼å•è¯æ¨¡å¼
                wordManager.setStudyMode('pindanci');
                log(`âœ… è®¾ç½®æ‹¼å•è¯æ¨¡å¼æˆåŠŸ`);
                
                // é€‰æ‹©ç¬¬ä¸€ä¸ªå•è¯
                wordManager.setSelectedWord(0);
                const currentWord = wordManager.getCurrentWord();
                log(`âœ… é€‰æ‹©å•è¯: ${currentWord.word} - ${currentWord.meaning}`);
                
                updateSpellingDisplay();
                log('åˆå§‹åŒ–å®Œæˆï¼');
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
            }
        }
        
        function testCorrectLetter() {
            if (!wordManager) {
                log('âŒ è¯·å…ˆåˆå§‹åŒ–æµ‹è¯•');
                return;
            }
            
            log('=== æµ‹è¯•2ï¼šé’“æ­£ç¡®å­—æ¯ ===');
            
            try {
                const progress = wordManager.getCurrentProgress();
                if (progress.spelledLetters.length >= progress.requiredLetters.length) {
                    log('âš ï¸ å•è¯å·²æ‹¼å†™å®Œæˆï¼Œè¯·é‡æ–°åˆå§‹åŒ–');
                    return;
                }
                
                const nextLetterIndex = progress.spelledLetters.length;
                const correctLetter = progress.requiredLetters[nextLetterIndex];
                
                log(`ğŸ“ å°è¯•é’“æ­£ç¡®å­—æ¯: ${correctLetter.toUpperCase()}`);
                
                const correctFishData = {
                    isCorrect: true,
                    letter: correctLetter,
                    displayText: correctLetter.toUpperCase()
                };
                
                const result = wordManager.onFishCaught(correctFishData);
                log(`âœ… é’“é±¼ç»“æœ: ${result ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
                
                updateSpellingDisplay();
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        function testWrongLetter() {
            if (!wordManager) {
                log('âŒ è¯·å…ˆåˆå§‹åŒ–æµ‹è¯•');
                return;
            }
            
            log('=== æµ‹è¯•3ï¼šé’“é”™è¯¯å­—æ¯ï¼ˆå…³é”®æµ‹è¯•ï¼‰===');
            
            try {
                const progress = wordManager.getCurrentProgress();
                const beforeSpelled = [...progress.spelledLetters];
                
                log(`ğŸ“ é’“é”™è¯¯å­—æ¯å‰çš„çŠ¶æ€: [${beforeSpelled.join(', ')}]`);
                
                // é’“ä¸€ä¸ªé”™è¯¯çš„å­—æ¯
                const wrongFishData = {
                    isCorrect: false,
                    letter: 'z',
                    displayText: 'Z'
                };
                
                log(`ğŸ£ å°è¯•é’“é”™è¯¯å­—æ¯: Z`);
                
                const result = wordManager.onFishCaught(wrongFishData);
                log(`ğŸ“Š é’“é±¼ç»“æœ: ${result ? 'æˆåŠŸ' : 'å¤±è´¥ï¼ˆé¢„æœŸï¼‰'}`);
                
                const afterSpelled = [...progress.spelledLetters];
                log(`ğŸ“ é’“é”™è¯¯å­—æ¯åçš„çŠ¶æ€: [${afterSpelled.join(', ')}]`);
                
                // éªŒè¯æ˜¯å¦æ­£ç¡®é‡ç½®
                if (afterSpelled.length === 0) {
                    log('âœ… æ‹¼å†™åŒºåŸŸå·²æ­£ç¡®æ¸…ç©ºï¼');
                } else {
                    log('âŒ æ‹¼å†™åŒºåŸŸæœªæ¸…ç©ºï¼Œå­˜åœ¨é—®é¢˜ï¼');
                }
                
                // æ£€æŸ¥é”™è¯¯å­—æ¯æ˜¯å¦è¢«æ·»åŠ 
                const hasWrongLetter = afterSpelled.includes('z');
                if (!hasWrongLetter) {
                    log('âœ… é”™è¯¯å­—æ¯æœªè¢«æ·»åŠ åˆ°æ‹¼å†™åŒºåŸŸï¼');
                } else {
                    log('âŒ é”™è¯¯å­—æ¯è¢«é”™è¯¯æ·»åŠ äº†ï¼');
                }
                
                log('âœ… é”™è¯¯å¤„ç†æµ‹è¯•å®Œæˆï¼šåªæ¸…ç©ºæ‹¼å†™åŒºï¼Œä¸æ¸…é™¤é±¼ç±»');
                
                updateSpellingDisplay();
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        function testCompleteWord() {
            if (!wordManager) {
                log('âŒ è¯·å…ˆåˆå§‹åŒ–æµ‹è¯•');
                return;
            }
            
            log('=== æµ‹è¯•4ï¼šå®Œæˆå•è¯æ‹¼å†™ ===');
            
            try {
                const progress = wordManager.getCurrentProgress();
                const requiredLetters = progress.requiredLetters;
                
                // é‡ç½®è¿›åº¦
                progress.spelledLetters = [];
                log('ğŸ“ é‡ç½®æ‹¼å†™è¿›åº¦ï¼Œå¼€å§‹å®Œæ•´æ‹¼å†™æµ‹è¯•');
                
                // é€ä¸ªæ·»åŠ æ­£ç¡®å­—æ¯
                for (let i = 0; i < requiredLetters.length; i++) {
                    const letter = requiredLetters[i];
                    const fishData = {
                        isCorrect: true,
                        letter: letter,
                        displayText: letter.toUpperCase()
                    };
                    
                    const result = wordManager.onFishCaught(fishData);
                    log(`ğŸ“ æ·»åŠ å­—æ¯ ${letter.toUpperCase()}: ${result ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
                    
                    if (wordManager.isGameComplete()) {
                        log('ğŸ‰ å•è¯æ‹¼å†™å®Œæˆï¼');
                        break;
                    }
                }
                
                updateSpellingDisplay();
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œåˆå§‹åŒ–æµ‹è¯•
        window.addEventListener('DOMContentLoaded', () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
            log('ğŸ‘† è¯·ç‚¹å‡»"1. åˆå§‹åŒ–æµ‹è¯•"æŒ‰é’®å¼€å§‹');
        });
    </script>
</body>
</html>